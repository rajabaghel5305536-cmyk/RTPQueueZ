name: Java CI with Maven

on:
push:
branches: [ "main" ]
pull_request:
branches: [ "main" ]

jobs:
build:
runs-on: ubuntu-latest

steps:
- uses: actions/checkout@v4
  with:
    # Fetch history to get version and commit information
    fetch-depth: 0

- name: Set up JDK 17
  uses: actions/setup-java@v4
  with:
    java-version: '17'
    distribution: 'temurin'
    cache: maven

- name: Build with Maven
  run: mvn clean package

- name: Get Plugin Version
  id: get_version
  run: echo "VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)" >> $GITHUB_OUTPUT

- name: Upload Artifact
  uses: actions/upload-artifact@v4
  with:
    name: RTPQueueZ-${{ steps.get_version.outputs.VERSION }}
    path: target/RTPQueueZ-${{ steps.get_version.outputs.VERSION }}.jar
    retention-days: 7
